{% extends 'base.html' %}

{% block content %}
<div class="chat-container">
    <h2 class="text-center">üí¨ Chat Room</h2>
    <div id="chat-box" class="chat-box border shadow-sm" style="height:400px; overflow:auto;"></div>
    <div class="input-group mt-3">
        <input type="text" id="message-input" class="form-control" placeholder="√âcris ton message...">
        <button id="send-button" class="btn btn-primary">Envoyer</button>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const protocol = window.location.protocol === 'https:' ? 'wss' : 'ws';
    const socket = new WebSocket(`${protocol}://${window.location.host}/ws/chat/`);

    socket.onopen = () => console.log("üü¢ WebSocket ouvert !");
    socket.onerror = (error) => console.log("‚ö†Ô∏è Erreur WebSocket :", error);
    socket.onclose = () => console.log("üî¥ WebSocket ferm√© !");

    socket.onmessage = (event) => {
        const data = JSON.parse(event.data);
        afficherMessage(data.message, "received");
    };

    document.getElementById("send-button").onclick = () => {
        const messageInput = document.getElementById("message-input");
        const message = messageInput.value;

        if (socket.readyState === WebSocket.OPEN && message) {
            socket.send(JSON.stringify({ message: message }));
            afficherMessage(message, "sent");
            messageInput.value = "";
        } else {
            console.error("‚ö†Ô∏è Le socket n'est pas ouvert ou message vide");
        }
    };

    function afficherMessage(message, type) {
        const chatBox = document.getElementById("chat-box");
        const messageDiv = document.createElement("div");
        messageDiv.classList.add("message", type);
        messageDiv.textContent = message;
        chatBox.appendChild(messageDiv);
        chatBox.scrollTop = chatBox.scrollHeight;
    }
});
</script>
{% endblock %}
